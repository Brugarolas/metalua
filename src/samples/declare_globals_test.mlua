-{ extension 'declare_globals' }

global a, b
global c = 3

a, b = 1, 2

local st1, msg1 = pcall(function()
   a = 4
   d = 5 -- failure, assignment to undeclared global
end)

local st2, msg2 = pcall(function()
   b = c -- OK
   local _ = d -- failure, try to read undeclared global
end)

assert(not st1)
printf ("This error was expected: %s", msg1)
assert(not st2)
printf ("This error was expected: %s", msg2)
assert(a==4)
assert(b==3)
assert(c==3)

print "Test passed."