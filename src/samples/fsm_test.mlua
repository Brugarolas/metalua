-{ extension 'machine' }

machine M
  state init
    on MSG1, MSG2 -> S1
  state S1
    when enter do
      print "do whatever you want in this Lua block" 
      print "it will be evaluated every time the machine enters state S1"
    end
    on SOME_MSG -> S2 -- When the machine is in state S1 and receives msg
                      -- SOME_MSG, jump to state S2.
  state S2
    do
      print "there's no explicit 'when' before this action block" 
      print "It's run when entering and updating the state by default"
    end
    on SOME_OTHER_MSG, OR_ANOTHER_MSG -> S1
 end

table.print(M, 60)